# DLoRAL Web应用使用指南

## 概述

DLoRAL Web应用提供了一个基于Gradio的用户友好界面，让您可以轻松使用DLoRAL模型进行视频超分辨率处理。

## 功能特点

- 🎬 **视频超分辨率**: 支持MP4格式视频的4倍超分辨率
- 🎨 **智能提示词**: 自动生成视频内容描述
- ⚙️ **参数调节**: 可调节处理尺寸、超分倍数等参数
- 🌈 **颜色校正**: 支持多种颜色校正方法
- 📱 **Web界面**: 直观易用的Web用户界面

## 安装和设置

### 1. 安装依赖

```bash
# 安装基础依赖
pip install -r requirements.txt

# 安装Web应用额外依赖
pip install -r requirements_web.txt
```

### 2. 下载模型文件

按照主README.md中的说明下载以下模型文件：

- `preset/models/ram_swin_large_14m.pth` - RAM模型
- `preset/models/DAPE.pth` - DAPE模型  
- `preset/models/checkpoints/model.pkl` - DLoRAL预训练权重

### 3. 检查环境

```bash
python start_web_app.py --check-only
```

## 启动Web应用

### 方法1: 使用启动脚本（推荐）

```bash
# 基本启动
python start_web_app.py

# 指定端口
python start_web_app.py --port 8080

# 启用公共链接（可分享给他人使用）
python start_web_app.py --share

# 指定主机地址
python start_web_app.py --host 127.0.0.1 --port 7860
```

### 方法2: 直接运行

```bash
python gradio_app.py
```

## 使用说明

### 1. 访问界面

启动成功后，在浏览器中访问：
- 本地访问: `http://localhost:7860`
- 局域网访问: `http://[您的IP]:7860`

### 2. 操作步骤

1. **初始化模型**
   - 点击"🚀 初始化模型"按钮
   - 等待模型加载完成

2. **上传视频**
   - 点击上传区域选择MP4格式视频文件
   - 支持常见视频格式

3. **设置参数**（可选）
   - 展开"⚙️ 高级参数"面板
   - 调整处理参数：
     - **提示词**: 额外的内容描述
     - **颜色校正方法**: adain/wavelet/nofix
     - **处理尺寸**: 256-1024像素
     - **超分倍数**: 2-8倍

4. **开始处理**
   - 点击"🎯 开始处理"按钮
   - 等待处理完成

5. **下载结果**
   - 处理完成后自动显示结果视频
   - 点击下载按钮保存到本地

### 3. 参数说明

| 参数 | 说明 | 推荐值 |
|------|------|--------|
| 提示词 | 额外的视频内容描述 | 可选，如"高清视频" |
| 颜色校正方法 | 颜色校正算法 | adain（推荐） |
| 处理尺寸 | 处理时的图像尺寸 | 512（平衡质量和速度） |
| 超分倍数 | 放大倍数 | 4（标准超分） |
| VAE编码器分块大小 | GPU内存优化参数 | 根据显存自动配置 |

### 4. 内存优化

**自动配置功能**:
- 点击"⚙️ 自动配置参数"按钮，系统会根据GPU显存自动设置最优参数
- 支持不同显存大小的GPU：
  - 8GB以下：低内存模式
  - 8-12GB：平衡模式  
  - 12-16GB：标准模式
  - 16-20GB：高性能模式
  - 20GB+：最高性能模式

**手动调整**:
- 如果出现内存不足错误，请降低VAE编码器分块大小
- 较小的分块大小会降低内存占用，但可能影响处理速度

## 注意事项

### 硬件要求

- **GPU**: 推荐NVIDIA GPU，至少8GB显存
- **内存**: 至少16GB系统内存
- **存储**: 足够的磁盘空间存储处理结果

### 性能优化

- **视频长度**: 建议处理30秒以内的视频
- **分辨率**: 建议输入分辨率不超过1080p
- **批处理**: 避免同时处理多个视频

### 常见问题

1. **模型初始化失败**
   - 检查模型文件是否完整
   - 确保CUDA环境正确配置

2. **处理时间过长**
   - 降低处理尺寸
   - 缩短视频长度
   - 检查GPU内存使用情况

3. **输出视频质量不佳**
   - 调整颜色校正方法
   - 增加处理尺寸
   - 检查输入视频质量

## 高级功能

### 自定义处理

可以通过修改`gradio_app.py`来自定义处理流程：

```python
# 修改处理参数
def custom_process_video(video_path, **kwargs):
    # 自定义处理逻辑
    pass
```

### 批量处理

可以扩展Web应用支持批量处理：

```python
# 添加批量上传功能
input_videos = gr.File(label="批量上传视频", file_count="multiple")
```

## 故障排除

### 错误日志

查看控制台输出的错误信息，常见错误包括：

- `CUDA out of memory`: GPU内存不足
- `Model file not found`: 模型文件缺失
- `Video format not supported`: 视频格式不支持

### 调试模式

启用调试模式获取详细信息：

```bash
python gradio_app.py --debug
```

## 技术支持

如果遇到问题，请：

1. 检查本文档的故障排除部分
2. 查看项目主README.md
3. 提交Issue到GitHub仓库

## 更新日志

- **v1.0.0**: 初始版本，支持基本视频超分功能
- **v1.1.0**: 添加参数调节和颜色校正选项
- **v1.2.0**: 优化界面设计和用户体验 